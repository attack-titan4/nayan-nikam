# url-metadata

Request a url and extract metadata from its html. Under the hood, this package does some post-request processing on top of the javascript native `fetch` API. Includes [Open Graph Protocol (og:)](http://ogp.me/) and [Twitter Card](https://developer.twitter.com/en/docs/twitter-for-websites/cards/overview/markup) meta tags. Support also added for [JSON-LD](https://moz.com/blog/json-ld-for-beginners).

To report a bug or request a feature please open an issue or pull request in [GitHub](https://github.com/laurengarcia/url-metadata).


## Usage
Works with Node.js version `>=18.0.0` or in the browser when bundled with Webpack or Browserify, etc.

Use previous version `2.5.0` which uses the (now-deprecated) `request` module instead if you don't have access to javascript-native `fetch` API in your target environment.

Install in your project:
```
$ npm install url-metadata --save
```

In your project file:
```javascript
const urlMetadata = require('url-metadata');

(async function () {
  try {
    const metadata = await urlMetadata('https://www.npmjs.com/package/url-metadata', {
      mode: 'same-origin',
      includeResponseBody: true
    });
    console.log('fetched metadata:', metadata)
  } catch(err) {
    console.log('fetch error:', err);
  }
})();
```

### Options & Defaults
The default options are the values below. To override the default options, pass in a second options argument.
```javascript
const options = {
  // custom request headers
  requestHeaders: {
    'User-Agent': 'url-metadata/3.0 (npm module)',
    'From': 'example@example.com',
  }

  // `fetch` API cache setting for request
  cache: 'no-cache',

  // `fetch` API mode (ex: `cors`, `no-cors`, `same-origin`, etc)
  mode: 'cors',

  // timeout in milliseconds, default is 10 seconds
  timeout: 10000,

  // number of characters to truncate description to
  descriptionLength: 750,

  // force image urls in selected tags to use https,
  // valid for 'image', 'og:image', 'og:image:secure_url' tags & favicons with full paths
  ensureSecureImageRequest: true,

  // return raw response body as string
  includeResponseBody: false
};

const metadata = await urlMetadata('https://www.npmjs.com/package/url-metadata', options);
```

### Returns
Returns a promise that is resolved with an object if the response is successful. Note that the `url` field returned will be the last hop in the request chain. So if you passed in a url that was generated by a url shortener you'll get back the final destination as the `url`.

The returned `metadata` object consists of key/value pairs that are all strings, with a few exceptions:
- `favicons` returns as array of objects containing key/value pairs (all strings)
- `jsonld` returns as object containing key/value pairs (all strings)
- if a meta tag named `og:type` with `content="article"` is present we return an object named `article` containing key/value pairs (all strings)
- all meta tags that begin with `citation_` (ex: `citation_author`) return with keys as strings and values that are an array of strings to conform to the [Google Scholar spec](https://www.google.com/intl/en/scholar/inclusion.html#indexing) which allows for multiple citation meta tags with different content values. So the html may contain this:
```
<meta name="citation_author" content="Arlitsch, Kenning">
<meta name="citation_author" content="OBrien, Patrick">
```
... and this module will return:
```
'citation_author': ["Arlitsch, Kenning", "OBrien, Patrick"],
```
